Only in asterisk-1.4.3/build_tools: menuselect-deps
diff -ur asterisk-1.4.3-orig/cdr/cdr_custom.c asterisk-1.4.3/cdr/cdr_custom.c
--- asterisk-1.4.3-orig/cdr/cdr_custom.c	2006-10-25 16:32:08.000000000 +0200
+++ asterisk-1.4.3/cdr/cdr_custom.c	2007-04-17 16:20:01.000000000 +0200
@@ -122,16 +122,17 @@
 	/* because of the absolutely unconditional need for the
 	   highest reliability possible in writing billing records,
 	   we open write and close the log file each time */
-	mf = fopen(master, "a");
+	/*mf = fopen(master, "a");
 	if (!mf) {
 		ast_log(LOG_ERROR, "Unable to re-open master file %s : %s\n", master, strerror(errno));
 	}
 	if (mf) {
 		fputs(buf, mf);
-		fflush(mf); /* be particularly anal here */
-		fclose(mf);
+		fflush(mf); *//* be particularly anal here */
+		/*fclose(mf);
 		mf = NULL;
-	}
+	}*/
+	ast_log(LOG_CDR, "%s", buf);
 	return 0;
 }
 
Only in asterisk-1.4.3/channels/h323: Makefile
Only in asterisk-1.4.3: config.log
Only in asterisk-1.4.3: config.status
Only in asterisk-1.4.3/include/asterisk: autoconfig.h
Only in asterisk-1.4.3/include/asterisk: buildopts.h
diff -ur asterisk-1.4.3-orig/include/asterisk/logger.h asterisk-1.4.3/include/asterisk/logger.h
--- asterisk-1.4.3-orig/include/asterisk/logger.h	2006-09-28 20:05:43.000000000 +0200
+++ asterisk-1.4.3/include/asterisk/logger.h	2007-04-17 16:04:22.000000000 +0200
@@ -129,6 +129,12 @@
 #define __LOG_DTMF  6
 #define LOG_DTMF    __LOG_DTMF, _A_
 
+#ifdef LOG_CDR
+#undef LOG_CDR
+#endif
+#define __LOG_CDR  7
+#define LOG_CDR    __LOG_CDR, _A_
+
 #if defined(__cplusplus) || defined(c_plusplus)
 }
 #endif
diff -ur asterisk-1.4.3-orig/main/logger.c asterisk-1.4.3/main/logger.c
--- asterisk-1.4.3-orig/main/logger.c	2006-12-27 23:06:56.000000000 +0100
+++ asterisk-1.4.3/main/logger.c	2007-04-19 10:10:34.000000000 +0200
@@ -54,7 +54,8 @@
 	LOG_WARNING,
 	LOG_ERR,
 	LOG_DEBUG,
-	LOG_DEBUG
+	LOG_DEBUG,
+	LOG_INFO
 };
 
 #define SYSLOG_NLEVELS sizeof(syslog_level_map) / sizeof(int)
@@ -121,7 +122,8 @@
 	"WARNING",
 	"ERROR",
 	"VERBOSE",
-	"DTMF"
+	"DTMF",
+	"CDR"
 };
 
 static int colors[] = {
@@ -162,6 +164,8 @@
 			res |= (1 << __LOG_VERBOSE);
 		else if (!strcasecmp(w, "dtmf"))
 			res |= (1 << __LOG_DTMF);
+		else if (!strcasecmp(w, "cdr"))
+			res |= (1 << __LOG_CDR);
 		else {
 			fprintf(stderr, "Logfile Warning: Unknown keyword '%s' at line %d of logger.conf\n", w, lineno);
 		}
@@ -530,6 +534,8 @@
 			ast_cli(fd, "Error ");
 		if (chan->logmask & (1 << __LOG_EVENT)) 
 			ast_cli(fd, "Event ");
+		if (chan->logmask & (1 << __LOG_CDR)) 
+			ast_cli(fd, "CDR ");
 		ast_cli(fd, "\n");
 	}
 	AST_LIST_UNLOCK(&logchannels);
@@ -647,7 +653,7 @@
 	return;
 }
 
-static void ast_log_vsyslog(int level, const char *file, int line, const char *function, const char *fmt, va_list args) 
+static void ast_log_vsyslog(int level, int facility, const char *file, int line, const char *function, const char *fmt, va_list args) 
 {
 	char buf[BUFSIZ];
 	char *s;
@@ -663,6 +669,9 @@
 	} else if (level == __LOG_DTMF) {
 		snprintf(buf, sizeof(buf), "DTMF[%ld]: ", (long)GETTID());
 		level = __LOG_DEBUG;
+	} else if (level == __LOG_CDR) {
+		snprintf(buf, sizeof(buf), "CDR[%ld]: ", (long)GETTID());
+		level = __LOG_CDR;
 	} else {
 		snprintf(buf, sizeof(buf), "%s[%ld]: %s:%d in %s: ",
 			 levels[level], (long)GETTID(), file, line, function);
@@ -670,7 +679,7 @@
 	s = buf + strlen(buf);
 	vsnprintf(s, sizeof(buf) - strlen(buf), fmt, args);
 	term_strip(s, s, strlen(s) + 1);
-	syslog(syslog_level_map[level], "%s", buf);
+	syslog(syslog_level_map[level] | facility, "%s", buf);
 }
 
 /*!
@@ -749,7 +758,7 @@
 		/* Check syslog channels */
 		if (chan->type == LOGTYPE_SYSLOG && (chan->logmask & (1 << level))) {
 			va_start(ap, fmt);
-			ast_log_vsyslog(level, file, line, function, fmt, ap);
+			ast_log_vsyslog(level, chan->facility, file, line, function, fmt, ap);
 			va_end(ap);
 		/* Console channels */
 		} else if ((chan->logmask & (1 << level)) && (chan->type == LOGTYPE_CONSOLE)) {
Only in asterisk-1.4.3: makeopts
Only in asterisk-1.4.3: makeopts.embed_rules
Only in asterisk-1.4.3/menuselect: autoconfig.h
Only in asterisk-1.4.3/menuselect: config.log
Only in asterisk-1.4.3/menuselect: config.status
Only in asterisk-1.4.3/menuselect: makeopts
Only in asterisk-1.4.3/menuselect/mxml: Makefile
Only in asterisk-1.4.3/menuselect/mxml: config.h
Only in asterisk-1.4.3/menuselect/mxml: mxml.list
Only in asterisk-1.4.3: menuselect-tree
Only in asterisk-1.4.3: menuselect.makedeps
Only in asterisk-1.4.3: menuselect.makeopts
