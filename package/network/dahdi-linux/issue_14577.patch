From c51319daee7c256ed1cbdc658475ced912c904e9 Mon Sep 17 00:00:00 2001
From: Shaun Ruffell <sruffell@digium.com>
Date: Wed, 20 May 2009 14:46:34 -0500
Subject: [PATCH] dahdi-base: Do not overwrite the hookstate at channel config.

(related to issue #14577)
---
 drivers/dahdi/dahdi-base.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/drivers/dahdi/dahdi-base.c b/drivers/dahdi/dahdi-base.c
index 4741720..d5cff81 100644
--- a/drivers/dahdi/dahdi-base.c
+++ b/drivers/dahdi/dahdi-base.c
@@ -4039,7 +4039,11 @@ static int dahdi_ctl_ioctl(struct inode *inode, struct file *file, unsigned int
 			y = dahdi_q_sig(chans[ch.chan]) & 0xff;
 			if (y >= 0)
 				chans[ch.chan]->rxsig = (unsigned char) y;
-			chans[ch.chan]->rxhooksig = DAHDI_RXSIG_INITIAL;
+			/* !!! Issue 14577.  When we configure the channel, do
+			 * not overwrite the hookstate that may have already
+			 * been set by the channel driver when it started up.
+			 * chans[ch.chan]->rxhooksig = DAHDI_RXSIG_INITIAL;
+			 */
 		}
 #ifdef CONFIG_DAHDI_DEBUG
 		module_printk(KERN_NOTICE, "Configured channel %s, flags %04lx, sig %04x\n", chans[ch.chan]->name, chans[ch.chan]->flags, chans[ch.chan]->sig);
-- 
1.6.0.6

